<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Incident</title>
    <script>
        // Function to handle the form submission and make the API call
        function createIncident(event) {
            event.preventDefault();  // Prevent the form from submitting normally

            // Get form data
            const formData = {
                caller_id: document.getElementById('caller_id').value,
                category: document.getElementById('category').value,
                short_description: document.getElementById('short_description').value,
                impact: document.getElementById('impact').value,
                urgency: document.getElementById('urgency').value
            };

            // Make the fetch call to the ServiceNow REST API
            fetch('https://dev187656.service-now.com/api/1299252/custom_website/inc_create', {
                method: 'POST',
                headers: {
                    'Authorization': 'Basic ' + btoa('admin:Ironman@109'),
                    'Content-Type': 'application/json',
                    'Accept': 'application/json',
                },
                body: JSON.stringify({ data: formData }),
                mode: 'cors',  // Ensure that the request follows CORS rules
            })
            .then(response => response.json())
            .then(result => {
                if (result.sys_id) {
                    alert('Incident created successfully! Sys ID: ' + result.sys_id);
                } else {
                    alert('Error: ' + result.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while creating the incident.');
            });
        }
    </script>
</head>
<body>
    <h1>Create Incident</h1>
    <form onsubmit="createIncident(event)">
        <label for="caller_id">Caller ID:</label>
        <input type="text" id="caller_id" name="caller_id" required><br><br>

        <label for="category">Category:</label>
        <input type="text" id="category" name="category" required><br><br>

        <label for="short_description">Short Description:</label>
        <input type="text" id="short_description" name="short_description" required><br><br>

        <label for="impact">Impact:</label>
        <input type="text" id="impact" name="impact" required><br><br>

        <label for="urgency">Urgency:</label>
        <input type="text" id="urgency" name="urgency" required><br><br>

        <button type="submit">Create Incident</button>
    </form>
</body>
</html>
